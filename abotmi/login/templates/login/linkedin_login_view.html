{% load i18n admin_static %}<!DOCTYPE html>
{% get_current_language as LANGUAGE_CODE %}{% get_current_language_bidi as LANGUAGE_BIDI %}
<html lang="{{ LANGUAGE_CODE|default:"en-us" }}" {% if LANGUAGE_BIDI %}dir="rtl"{% endif %}>
    <head>
        <title>ABOTMI</title>
        {% load staticfiles %}
        <meta charset="utf-8">
        <!--webfonts-->
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:600italic,400,300,600,700' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" type="text/css" href="{% static 'new_theme/assets/css/responsive.css' %}" media="screen">
        <link rel="stylesheet" href="{% static 'new_theme/assets/css/bootstrap.min.css' %}" type="text/css" media="screen">
        <link rel="stylesheet" type="text/css" media="screen" href="{% static 'new_theme/assets/css/social_buttons.css' %}"/>
    </head>
    <body>
       <h2><center>ABOTMI</center></h2>
        <form id="fb_login" action="/login/facebook/" method="POST">
        {% csrf_token %}
            <p>ABOTMI is a professional network that connects you with the most reliable and trustworthy digital asset advisors across the globe.</p><br/>
            <!-- commented temporarly -->
            <!-- <a onclick="onLinkedInLoad('signup_or_login');" class="btn btn-lg btn-linkedin"><i class="fa fa-linkedin"></i> Join </a> -->
            <!-- <script type="in/Login"></script> -->
            <div id="fetch_data"></div>
            <!-- Hidden inputs -->
            <input id="next_url" name="next_url" type="hidden" value="{{next}}"/>
            <div id="data_fetched"></div>
        </form>
    </body>
    <script type="text/javascript" src="{% static 'new_theme/assets/js/jquery-min.js' %}"></script>
    <script type="text/javascript" src="//platform.linkedin.com/in.js">
        api_key: {{LINKEDIN_API}}
        authorize: true
        scope: r_basicprofile,r_emailaddress,w_share
    </script>
    <script type="text/javascript">
        //r_fullprofile
        function onLinkedInLoad(from_state) {
          IN.UI.Authorize().place();
          IN.Event.on(IN, "auth", onLinkedInAuth);
        }
        function onLinkedInAuth() {
            IN.API.Profile("me")
            .fields("firstName", "lastName", "industry", "location:(name)", "picture-url", "headline", "summary", "num-connections", "public-profile-url", "distance", "positions", "email-address", "educations","date-of-birth")
            .result(displayProfiles)
            .error(displayProfilesErrors);
        }
        function displayProfiles(profiles) {
            member = profiles.values[0];
            var token = "{{csrf_token}}";
            $.ajax({
                type: "POST",
                url : "/login/linkedin/",
                beforeSend: function (request) {
                    request.setRequestHeader("X-CSRFToken", token );
                },
                data: {
                    user_name : member.emailAddress,
                    first_name: member.firstName,
                    last_name : member.lastName,
                    email     : member.emailAddress,
                    gender    : 'Male',
                    birthday  : '1990-07-11',
                    next_url  : $('#next_url').val()
                }, success:function(response){
                    if(response == "new_user") {
                        shareContent()
                        window.location = "{{GOOGLE_REDIRECT}}";
                    }
                    if(response == "user_exist"){
                        window.location = "{{GOOGLE_REDIRECT}}";
                    }
                    if(response == "deactivated"){
                        alert('your account is not active call customer care');
                    }
                }
            });
        }
        function displayProfilesErrors(error) {
            profilesDiv = document.getElementById("fetch_data");
            profilesDiv.innerHTML = error.message;
        }
        function shareContent() {
            // Build the JSON payload containing the content to be shared
            var payload = {
                "comment": "Check out ABOTMI.com",
                "content": {
                    "title": "ABOTMI",
                    "description": "Grow by Creating Wealth for the Real Estate Investors",
                    "submitted-url": "{{FACEBOOK_SINGLE_URL}}",
                    "submitted-image-url": "{{LINKEDIN_IMAGE_URL}}"
                },
                "visibility": {
                    "code": "anyone"
                }
            };
            IN.API.Raw("/people/~/shares?format=json")
            .method("POST")
            .body(JSON.stringify(payload))
            .result(onSuccess)
            .error(onError);
        }
        function onSuccess(data) {
            var data = data;
        }
        function onError(error) {
            var error = error;
        }
    </script>
    <script src="{% static 'js/WearProtection.js' %}"></script>
</html>
